{% raw %}
kind: Secret
apiVersion: v1
metadata:
  name: plural-edge-{{ configuration.name }}-cloud-config
stringData:
  userdata: |
    #cloud-config
    
    hostname: plural-edge-{{ trunc 10 .MachineID }}
    
    users:
      - name: "{{ configuration.username }}"
        passwd: "{{ configuration.password }}"
        groups: ["admin"]
    
    k3s:
      enabled: true
      replace_args: true
      args:
        - --node-name={{ configuration.name }}
    
    bundles:
      - targets:
          - run://ghcr.io/pluralsh/kairos-plural-bundle:latest
    
    plural:
      token: {{ configuration.token }}
      url: {{ configuration.url }}
{% endraw %}
