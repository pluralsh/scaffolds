{% raw %}
apiVersion: deployments.plural.sh/v1alpha1
kind: PreviewEnvironmentTemplate
metadata:
  name: {{ configuration.name }}
spec:
  flowRef:
    name: {{ configuration.name }}

  referenceServiceRef:
    name: {{ configuration.name }}-dev
    namespace: {{ configuration.name }}
{% endraw %}
  template:
    namespace: "{{ configuration.name }}-pr-{{ "{% raw %}" }}{% raw %}{{ pr.number }}{% endraw %}{{ "{% endraw %}" }}"
    name: "{{ configuration.name }}-pr-{{ "{% raw %}" }}{% raw %}{{ pr.number }}{% endraw %}{{ "{% endraw %}" }}"
    syncConfig:
      deleteNamespace: true
    helm:
      values:
        image:
          tag: "sha-{{ "{% raw %}" }}{% raw %}{{ commitSha | slice: 0, 7 }}{% endraw %}{{ "{% endraw %}" }}"
