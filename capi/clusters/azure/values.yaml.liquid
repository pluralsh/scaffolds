cluster:
  name: {{ configuration.clusterName }}
  kubernetesVersion: {{ configuration.version }}
  subscriptionID: {{ configuration.subscriptionId }}
  location: {{ configuration.location }}
  resourceGroupName: {{ configuration.resourceGroup }}
  virtualNetwork:
    name: {{ configuration.network }}

{% if configuration.nodePools and configuration.nodePools.size != 0 -%}
workers:
  plural-system-internal:
    replicas: 1
    spec:
      additionalTags:
        ScalingGroup: small-sustained-on-demand
      mode: System
      nodeLabels:
        plural.sh/capacityType: ON_DEMAND
        plural.sh/performanceType: SUSTAINED
        plural.sh/scalingGroup: small-sustained-on-demand
      scaling:
        maxSize: 9
        minSize: 1
      sku: Standard_D2as_v5
  {%- for nodePool in configuration.nodePools %}
  {{ nodePool.name }}:
    isMultiAZ: true
    spec:
      sku: {{ nodePool.instance_type }}
      scaling:
        maxSize: {{ nodePool.max_size }}
        minSize: {{ nodePool.min_size }}
      {% if nodePool.spot -%}
      scaleSetPriority: Spot
      spotMaxPrice: -1
      {% endif -%}
      {% if nodePool.labels -%}
      nodeLabels: {{ nodePool.labels | json -}}
      {% endif -%}
      {% if nodePool.taints and nodePool.taints.size != 0 -%}
      taints:
      {% for taint in nodePool.taints -%}
      - key: {{ taint.key }}
        value: {{ taint.value }}
        effect: {{ taint.effect }}
      {% endfor -%}
      {% endif -%}
  {% endfor -%}
{% endif -%}
